# status-bar on top
set-option -g status-position top

set -g status-left ""

# increase length of status-right (right part of status bar)
set -g status-right-length 200

# status-bar show pwd like `~ > a > ... > e > f`
set -g status-right "#(echo '#{pane_current_path}' | sed 's#$HOME#~#; s#\\([^/]*/[^/]*/\\).*\\(/[^/]*/.*\\)$#\\1...\\2#; s#/#/#g') |#S|%H:%M"

# enable mouse
set -g mouse on

# allow apps running in Tmux to set in system clipboard
set -s set-clipboard on
set -as terminal-features ',xterm-256color:clipboard'

# update indexes
set -g renumber-windows on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# "display" (terminal)
set -g default-terminal "tmux-256color"
# set -ag terminal-overrides ",xterm-256color:RGB"
set-option -ga terminal-overrides ",xterm-256color:Tc"


# Key binding

bind R source-file ~/.config/tmux/tmux.conf \; display-message "Configuration reloaded üëç"

# override new pane/window starting path to pwd of active pane
bind  c  new-window      -c "#{pane_current_path}"
bind  %  split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"

# binds the start select and copy to Vi(m) like [v]isual and [y]ank
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel
bind-key -T copy-mode-vi 'V' send -X select-line
set-window-option -g mode-keys vi

# binds vi(m) pane navigation keys & knows if its vim or tmux  
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
is_fzf="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?fzf$'"
bind -n C-h run "($is_vim && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "($is_vim && tmux send-keys C-j)  || ($is_fzf && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "($is_vim && tmux send-keys C-k) || ($is_fzf && tmux send-keys C-k)  || tmux select-pane -U"
bind -n C-l run  "($is_vim && tmux send-keys C-l) || tmux select-pane -R"
bind-key -n C-\\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# To allow "Yazi" file manager to show images preview inside terminal
# - requires to enable selen
set -g allow-passthrough all
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# === TPM dependency plugins ===
set -g @plugin 'tmux-plugins/tpm'

# === Plugins ================== 
# (Order of plugins matters)

# 1 Priority plugins
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'ofirgall/tmux-window-name'

# 2 Priority plugins
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'alexwforsythe/tmux-which-key'

# Color scheme plugin
set -g @plugin 'catppuccin/tmux#v2.1.2' # See https://github.com/catppuccin/tmux/tags for additional tags


# === Plugins' configuration ===

set -g @tmux_window_name_shells "['bash', 'fish', 'sh', 'zsh','ps']" # show dir
set -g @tmux_window_dir_programs "['nvim', 'vim', 'vi', 'git']" # show dir
# set -g @tmux_window_name_ignored_programs "['sqlite3']" # won't show dir
# set -g @tmux_window_name_use_tilde "True"
set -g @tmux_window_name_max_name_len "20"
set -g @tmux_window_name_use_tilde "False"

set -g @resurrect-capture-pane-contents 'on'

# continuum session autosaving
set -g @continuum-save-interval '10'
set -g @continuum-restore 'on'

# catppuccin reverts window(tabs) names to tmux
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_window_text "#W"

# === Install TPM if not installed ===
if "test ! -d ~/.config/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

# Plugin to  auto-reload config, (keep at the bottom of tmux.conf) https://github.com/b0o/tmux-autoreload
# set-option -g @plugin 'b0o/tmux-autoreload'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'

# Message displayed after config was loaded.
display-message "Latest tmux.conf loaded üëç ‚úì "
